webpackJsonp([2],{"3cXf":function(t,e,i){t.exports={default:i("pELq"),__esModule:!0}},BlcD:function(t,e){},iNzT:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,s=i("a3Yh"),o=i.n(s),r=i("3cXf"),a=i.n(r),u=i("lC5x"),c=i.n(u),l=i("IHPB"),p=i.n(l),d=i("wd27"),h=i("gyMJ"),f=(i("B58l"),i("ryJa")),m=i.n(f);i("5Spc");m.a.locale("zh-cn");var v={radio:{questionType:1,questionTitle:"",questionOption:["",""]},checkbox:{questionType:2,questionTitle:"",questionOption:["",""]},textarea:{questionType:3,questionTitle:"",questionOption:[]}},_={name:"Edit",components:{loader:d.a},directives:{focus:{update:function(t){return t.focus()}}},filters:{transformQursiotnType:function(t){return 1===t?"(单选题)":2===t?"(多选题)":"(文本题)"}},data:function(){return{excelFile:null,excelFileName:"",paperObj:{},questionList:[],curIndex:"",curOptIndex:"",promptText:"",iterator:null,isEditMode:!1,isAdding:!1,titleEditing:!1,topicEditing:!1,isShowPrompt:!1,isShowDatepicker:!1,isLoading:!1,dateFormat:"YYYY-MM-DD HH:mm:ss"}},created:function(){console.log(this.$route.path),this.isEditMode="/lists/add"!==this.$route.path,this.isEditMode?this._getPaper():this.paperObj={title:"",status:0,startTime:(new Date).toLocaleString().substr(0,17),endTime:(new Date).toLocaleString().substr(0,17),questions:[]}},methods:(n={moment:m.a,range:function(t,e){for(var i=[],n=t;n<e;n++)i.push(n);return i},disabledDate:function(t){return t<m()().subtract(1,"day")},onDataChange:function(t,e){this.paperObj.startTime=e[0],this.paperObj.endTime=e[1]},switchItem:function(t,e){this.optIndex="",this.curIndex="";var i=e.splice(t,2);e.splice.apply(e,[t,0].concat(p()(i.reverse())))},moveUp:function(t,e){this.switchItem(t-1,e)},moveDown:function(t,e){this.switchItem(t,e)},errorPrompt:function(t){this.iterator=null,this.showPrompt(t)},downLoadExcel:function(){window.open(h.a+"/template.xls")},importExcel:function(){this.$refs.fileInput.click()},fileChange:function(t){var e=t.target.files[0],i=e.name.split(".").pop();"xls"!==i&&"xlsx"!==i?this.showPrompt("上传文件格式错误"):(this.excelFile=e,this.excelFileName=e.name)},backBtn:c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.showPrompt("确认未保存回到主页吗？");case 2:return t.next=4,this.$router.push({path:"/"});case 4:case"end":return t.stop()}},t,this)}),deleteQuestion:c.a.mark(function t(e){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.questionList.length<=1)){t.next=3;break}return this.errorPrompt("每份问卷至少一个问题！"),t.abrupt("return");case 3:return console.log("asd"),t.next=6,this.showPrompt("确定要删除该问题吗？");case 6:return t.next=8,this.questionList.splice(e,1);case 8:case"end":return t.stop()}},t,this)}),deleteOption:function(t,e){e.length<=2?this.errorPrompt("每个问题至少两个选项"):e.splice(t,1)},addOption:function(t){6!==t.length?t.push(""):this.errorPrompt("每个问题至多六个选项")},showPrompt:function(t){this.promptText=t,this.isShowPrompt=!0},addQuestion:function(t){if(10!==this.questionList.length){var e=JSON.parse(a()(v[t]));this.questionList.push(e)}else this.errorPrompt("每份问卷至多10个问题！")},validatePaper:function(){return this.paperObj.title?this.questionList.length?this.questionList.every(function(t){var e=t.questionOption.filter(function(t){return""===t});return""!==t.questionTitle&&!e.length})?this.paperObj.startTime&&this.paperObj.endTime?this.paperObj.startTime!=this.paperObj.endTime||(this.errorPrompt("开始结束日期不能相同！"),!1):(this.errorPrompt("请填写问卷发布时间段！"),!1):(this.errorPrompt("请完善问卷题目内容！"),!1):(this.errorPrompt("每份问卷至少一个问题！"),!1):(this.errorPrompt("请填写问卷标题"),!1)}},o()(n,"backBtn",c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.showPrompt("确认未保存回到主页吗？");case 2:return t.next=4,this.$router.push({path:"/"});case 4:case"end":return t.stop()}},t,this)})),o()(n,"savePaper",c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.validatePaper()){t.next=5;break}return t.next=3,this.showPrompt("确认保存问卷吗？");case 3:return t.next=5,this._savePaper();case 5:case"end":return t.stop()}},t,this)})),o()(n,"savePaperExcel",c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.showPrompt("确认保存问卷表格吗？");case 2:return t.next=4,this._uploadPaper();case 4:case"end":return t.stop()}},t,this)})),o()(n,"_getPaper",function(){var t=this,e={id:this.$route.query.id};this.isLoading=!0,Object(h.e)(e).then(function(e){0===e.code&&("lists/re-edit"===t.$route.path&&(delete e.data.id,delete e.data.createdTime,e.data.status=0),t.paperObj=e.data,t.questionList=e.data.questions,t.isLoading=!1)})}),o()(n,"_savePaper",function(){var t=this,e=this.paperObj;this.paperObj.questions=this.questionList,Object(h.j)(e).then(function(e){0===e.code&&t.$router.push({path:"/"})})}),o()(n,"_releasePaper",function(){var t=this;if(this.validatePaper()){var e=this.paperObj;this.paperObj.status=1,this.paperObj.questions=this.questionList,Object(h.j)(e).then(function(e){0===e.code?t.$router.push({path:"/"}):t.$message.info(e.msg)})}}),o()(n,"_uploadPaper",function(){var t=this,e=new FormData;e.append("file",this.excelFile),Object(h.k)(e).then(function(e){0===e.code?t.$router.push({path:"/"}):t.showPrompt(e.msg)})}),n)},x={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"qu-wrap"},[i("header",[i("span",{on:{click:function(e){t.iterator=t.backBtn(),t.iterator.next()}}},[i("a-icon",{attrs:{type:"arrow-left"}}),t._v("返回\n      ")],1),t._v(" "),i("p",{directives:[{name:"show",rawName:"v-show",value:!t.titleEditing,expression:"!titleEditing"}],on:{click:function(e){t.titleEditing=!0}}},[t._v(t._s(t.paperObj.title||"问卷标题"))]),t._v(" "),i("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:t.paperObj.title,expression:"paperObj.title"}],class:{inlineShow:t.titleEditing},attrs:{type:"text"},domProps:{value:t.paperObj.title},on:{blur:function(e){t.titleEditing=!1},keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.titleEditing=!1},input:function(e){e.target.composing||t.$set(t.paperObj,"title",e.target.value)}}})]),t._v(" "),i("div",{staticClass:"qu-content"},[t._l(t.questionList,function(e,n){return i("section",{key:n,staticClass:"qu-item",class:{nowEditing:t.curIndex===n&&t.topicEditing,optEditing:t.curIndex===n}},[i("div",{staticClass:"clearfix"},[i("h3",{staticClass:"fl",on:{click:function(e){t.curIndex=n,t.curOptIndex="",t.topicEditing=!0}}},[i("span",{staticClass:"qu-num"},[t._v(t._s("Q"+(n+1)))]),t._v(" "),i("span",{staticClass:"qu-topic"},[t._v(t._s(e.questionTitle||"请编辑题目内容"))]),t._v(" "),i("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.questionTitle,expression:"item.questionTitle"}],attrs:{type:"text"},domProps:{value:e.questionTitle},on:{blur:function(e){t.topicEditing=!1},keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.topicEditing=!1},input:function(i){i.target.composing||t.$set(e,"questionTitle",i.target.value)}}}),t._v(" "),i("span",{staticClass:"qu-type"},[t._v(t._s(t._f("transformQursiotnType")(e.questionType)))])]),t._v(" "),i("ul",{staticClass:"operat-list fr"},[0!==n?i("li",{on:{click:function(e){return t.moveUp(n,t.questionList)}}},[t._v("上移")]):t._e(),t._v(" "),n!==t.questionList.length-1?i("li",{on:{click:function(e){return t.moveDown(n,t.questionList)}}},[t._v("下移")]):t._e(),t._v(" "),i("li",{on:{click:function(e){t.iterator=t.deleteQuestion(n),t.iterator.next()}}},[t._v("删除")])])]),t._v(" "),3===e.questionType?i("textarea",{attrs:{rows:"8",cols:"80"}}):i("ul",{staticClass:"options-list"},t._l(e.questionOption,function(s,o){return i("li",{key:o,class:{optionEditing:t.curOptIndex===o}},[i("span",{staticClass:"optionText",on:{click:function(e){t.curIndex=n,t.curOptIndex=o,t.topicEditing=!1}}},[t._v(t._s(s||"请编辑选项内容"))]),t._v(" "),i("input",{directives:[{name:"focus",rawName:"v-focus"},{name:"model",rawName:"v-model",value:e.questionOption[o],expression:"item.questionOption[optIndex]"}],attrs:{type:"text"},domProps:{value:e.questionOption[o]},on:{blur:function(e){t.curIndex=""},keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.curIndex=""},input:function(i){i.target.composing||t.$set(e.questionOption,o,i.target.value)}}}),t._v(" "),i("ul",{staticClass:"opt-ctrl"},[o===e.questionOption.length-1?i("li",{on:{click:function(i){return t.addOption(e.questionOption)}}},[t._v("添加")]):t._e(),t._v(" "),i("li",{on:{click:function(i){return t.deleteOption(o,e.questionOption)}}},[t._v("删除")])])])}),0),t._v(" "),i("div")])}),t._v(" "),i("ul",{staticClass:"list_ul clearfix"},[null===t.excelFile?i("li",{staticClass:"list_add_btn"},[i("div",{staticClass:"list_tit"},[t._v("添加问题")]),t._v(" "),i("div",{staticClass:"list_open_bg"},[i("div",{staticClass:"list_btn_pos"},[i("a-button",{attrs:{size:"small"},on:{click:function(e){return t.addQuestion("radio")}}},[t._v("单选题")]),t._v(" "),i("a-button",{attrs:{size:"small"},on:{click:function(e){return t.addQuestion("checkbox")}}},[t._v("多选题")]),t._v(" "),i("a-button",{attrs:{size:"small"},on:{click:function(e){return t.addQuestion("textarea")}}},[t._v("文本题")])],1)])]):t._e(),t._v(" "),t.questionList.length?t._e():i("li",{staticClass:"list_download_btn"},[i("div",{staticClass:"list_tit",on:{click:function(e){return t.downLoadExcel()}}},[t._v("下载Excel模板")])]),t._v(" "),t.questionList.length?t._e():i("li",{staticClass:"list_upload_btn"},[t.isEditMode?t._e():i("div",{staticClass:"list_tit",on:{click:function(e){return t.importExcel()}}},[i("p",[i("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:function(e){return t.fileChange(e)}}}),t._v(" "),i("span",[t._v(t._s(t.excelFileName||"上传Excel表格"))])])])])])],2),t._v(" "),i("footer",[null===t.excelFile?[i("div",[i("a-range-picker",{attrs:{disabledDate:t.disabledDate,placeholder:["开始时间","结束时间"],value:t.paperObj.startTime?[t.moment(t.paperObj.startTime,t.dateFormat),t.moment(t.paperObj.endTime,t.dateFormat)]:[],ranges:{"今天":[t.moment(),t.moment()],"月末":[t.moment(),t.moment().endOf("month")]},showTime:"",locale:"{locale}"},on:{change:t.onDataChange}})],1),t._v(" "),i("div",{staticClass:"ctrl-part"},[i("a-button",{on:{click:function(e){t.iterator=t.savePaper(),t.iterator.next()}}},[t._v("保存问卷")]),t._v(" "),i("a-button",{attrs:{type:"primary"},on:{click:t._releasePaper}},[t._v("发布问卷")])],1)]:i("div",{staticClass:"upload-part"},[i("span",{on:{click:function(e){t.iterator=t.savePaperExcel(),t.iterator.next()}}},[t._v("保存问卷表格")])])],2)]),t._v(" "),i("a-modal",{attrs:{title:"提示",centered:"",okText:"确定",cancelText:"取消"},on:{ok:function(e){t.isShowPrompt=!1,t.iterator&&t.iterator.next()},cancel:function(e){t.isShowPrompt=!1}},model:{value:t.isShowPrompt,callback:function(e){t.isShowPrompt=e},expression:"isShowPrompt"}},[i("p",[t._v(t._s(t.promptText))])]),t._v(" "),i("loader",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}]})],1)},staticRenderFns:[]};var g=i("C7Lr")(_,x,!1,function(t){i("BlcD")},"data-v-aa2d67a8",null);e.default=g.exports},pELq:function(t,e,i){var n=i("xhIC"),s=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(t){return s.stringify.apply(s,arguments)}}});